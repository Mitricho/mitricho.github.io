<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- qtquick3d-examples-xrinput.qdoc -->
  <meta name="description" content="Demonstrates controller input in Qt Quick 3D XR.">
  <title>Qt Quick 3D - XR Simple Input Example | Qt Quick 3D | Qt 6.9.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li>Qt 6.9</li>
<li><a href="qtquick3d-index.html">Qt Quick 3D</a></li>
<li><a href="quick3d-examples.html">Qt Quick 3D Examples and Tutorials</a></li>
<li>Qt Quick 3D - XR Simple Input Example</li>
<li id="buildversion"><a href="qtquick3d-index.html">Qt Quick 3D | Commercial or GPLv3</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#controller-input">Controller Input</a></li>
<li class="level1"><a href="#xritem">XrItem</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Qt Quick 3D - XR Simple Input Example</h1>
<!-- $$$xr_input-brief -->
<p>Demonstrates controller input in Qt Quick 3D XR.</p>
<!-- @@@xr_input -->
<!-- $$$xr_input-description -->
<div class="descr" id="details">
<p class="centerAlign"><img src="images/xrinput-example.jpg" alt="" /></p><p>This example shows how to use the low-level input APIs in Qt Quick 3D XR to interact with 2D and 3D objects in the scene. It follows the basic structure of the <a href="qtquick3d-xr-simple-example.html">xr_simple</a> example.</p>
<h4 id="controller-input">Controller Input</h4>
<p>In this example, we do <a href="qml-qtquick3d-xr-xrview.html#rayPick-method" translate="no">ray picking</a> from the position of the <a href="qml-qtquick3d-xr-xrcontroller.html" translate="no">XrController</a>:</p>
<pre class="qml" translate="no">
 <span class="type"><a href="qml-qtquick3d-xr-xrcontroller.html" translate="no">XrController</a></span> {
     <span class="name">id</span>: <span class="name">rightController</span>
     <span class="name">controller</span>: <span class="name">XrController</span>.<span class="name">RightController</span>
     <span class="name">poseSpace</span>: <span class="name">XrController</span>.<span class="name">AimPose</span>

     property <span class="type"><a href="../qtqml/qml-qtqml-qtobject.html" translate="no">QtObject</a></span> <span class="name">hitObject</span>

     <span class="name">onRotationChanged</span>: {
         const pickResult = <span class="name">xrView</span>.<span class="name">rayPick</span>(<span class="name">scenePosition</span>, <span class="name">forward</span>)
         <span class="keyword">if</span> (<span class="name">pickResult</span>.<span class="name">hitType</span> <span class="operator">!==</span> <span class="name">PickResult</span>.<span class="name">Null</span>) {
             <span class="name">pickRay</span>.<span class="name">hit</span> <span class="operator">=</span> <span class="number">true</span>
             <span class="name">pickRay</span>.<span class="name">length</span> <span class="operator">=</span> <span class="name">pickResult</span>.<span class="name">distance</span>
             <span class="name">hitObject</span> <span class="operator">=</span> <span class="name">pickResult</span>.<span class="name">objectHit</span>
             <span class="name">cursorSphere</span>.<span class="name">position</span> <span class="operator">=</span> <span class="name">pickResult</span>.<span class="name">scenePosition</span>
             <span class="name">cursorSphere</span>.<span class="name">visible</span> <span class="operator">=</span> <span class="number">true</span>
         } <span class="keyword">else</span> {
             <span class="name">pickRay</span>.<span class="name">hit</span> <span class="operator">=</span> <span class="number">false</span>
             <span class="name">pickRay</span>.<span class="name">length</span> <span class="operator">=</span> <span class="number">50</span>
             <span class="name">hitObject</span> <span class="operator">=</span> <span class="number">null</span>
             <span class="name">cursorSphere</span>.<span class="name">visible</span> <span class="operator">=</span> <span class="number">false</span>
         }
     }

     <span class="type"><a href="qml-qtquick3d-node.html" translate="no">Node</a></span> {
         <span class="name">id</span>: <span class="name">pickRay</span>
         property <span class="type"><a href="../qtqml/qml-real.html" translate="no">real</a></span> <span class="name">length</span>: <span class="number">50</span>
         property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">hit</span>: <span class="number">false</span>

         <span class="type"><a href="qml-qtquick3d-model.html" translate="no">Model</a></span> {
             <span class="name">eulerRotation</span>.x: -<span class="number">90</span>
             <span class="name">scale</span>: <span class="name">Qt</span>.<span class="name">vector3d</span>(<span class="number">0.005</span>, <span class="name">pickRay</span>.<span class="name">length</span><span class="operator">/</span><span class="number">100</span>, <span class="number">0.005</span>)
             <span class="name">source</span>: <span class="string">&quot;#Cone&quot;</span>
             <span class="name">materials</span>: <span class="name">PrincipledMaterial</span> {
                 <span class="name">baseColor</span>: <span class="name">rightTrigger</span>.<span class="name">pressed</span> ? <span class="string">&quot;#99aaff&quot;</span> : <span class="string">&quot;#cccccc&quot;</span>
                 <span class="name">lighting</span>: <span class="name">PrincipledMaterial</span>.<span class="name">NoLighting</span>
             }
             <span class="name">opacity</span>: <span class="number">0.8</span>
         }
     }

     <span class="type"><a href="qml-qtquick3d-node.html" translate="no">Node</a></span> {
         <span class="name">z</span>: <span class="number">5</span>
         <span class="type"><a href="qml-qtquick3d-model.html" translate="no">Model</a></span> {
             <span class="name">eulerRotation</span>.x: <span class="number">90</span>
             <span class="name">scale</span>: <span class="name">Qt</span>.<span class="name">vector3d</span>(<span class="number">0.05</span>, <span class="number">0.10</span>, <span class="number">0.05</span>)
             <span class="name">source</span>: <span class="string">&quot;#Cylinder&quot;</span>
             <span class="name">materials</span>: <span class="name">PrincipledMaterial</span> {
                 <span class="name">baseColor</span>: <span class="string">&quot;black&quot;</span>
                 <span class="name">roughness</span>: <span class="number">0.2</span>
             }
         }
     }
 }
</pre>
<p>This performs the following functions:</p>
<ul>
<li>If we hit anything, we change the length of the <code translate="no">pickRay</code> to so it touches the thing we hit. The <code translate="no">pickRay</code> is a semi-transparent cone (a tapered cylinder) that shows where the user is aiming. We also move <code translate="no">cursorSphere</code> to the point where the ray hits. (<code translate="no">cursorSphere</code> is a semi-transparent sphere which is a child of the <a href="qml-qtquick3d-xr-xrview.html" translate="no">XrView</a>).</li>
<li>We set the property <code translate="no">hitObject</code> to the object that we hit.</li>
</ul>
<p>We also use a black cylinder as a generic representation of the controller.</p>
<p>For this example, we have made a simple 3D push button in the file <code translate="no">ExampleButton.qml</code>. (The details of how the button works are not explained here.) We create an <a href="qml-qtquick3d-xr-xrinputaction.html" translate="no">XrInputAction</a> to react to trigger presses:</p>
<pre class="qml" translate="no">
 <span class="type"><a href="qml-qtquick3d-xr-xrinputaction.html" translate="no">XrInputAction</a></span> {
     <span class="name">id</span>: <span class="name">rightTrigger</span>
     <span class="name">hand</span>: <span class="name">XrInputAction</span>.<span class="name">RightHand</span>
     <span class="name">actionId</span>: [<span class="name">XrInputAction</span>.<span class="name">TriggerPressed</span>, <span class="name">XrInputAction</span>.<span class="name">TriggerValue</span>, <span class="name">XrInputAction</span>.<span class="name">IndexFingerPinch</span>]
     <span class="name">onTriggered</span>: {
         const button = <span class="name">rightController</span>.<span class="name">hitObject</span> <span class="operator">as</span> <span class="name">ExampleButton</span>
         <span class="keyword">if</span> (<span class="name">button</span> <span class="operator">&amp;&amp;</span> <span class="name">button</span> <span class="operator">!==</span> <span class="name">panel</span>.<span class="name">activeButton</span>) {
             <span class="name">panel</span>.<span class="name">activeButton</span> <span class="operator">=</span> <span class="name">button</span>
         }
     }
 }
</pre>
<p>The <code translate="no">rightTrigger</code> action reacts to several different IDs in order to support both hand tracking and different types of controllers. When the action is triggered, it checks if the <code translate="no">hitObject</code> we set above is of the type <code translate="no">ExampleButton</code>. In that case, the button is activated.</p>
<p>To allow a 3D controller to interact with 2D content, we need to add an <a href="qml-qtquick3d-xr-xrvirtualmouse.html" translate="no">XrVirtualMouse</a> to map between them:</p>
<pre class="qml" translate="no">
 <span class="type"><a href="qml-qtquick3d-xr-xrinputaction.html" translate="no">XrInputAction</a></span> {
     <span class="name">id</span>: <span class="name">rightThumbstickX</span>
     <span class="name">hand</span>: <span class="name">XrInputAction</span>.<span class="name">RightHand</span>
     <span class="name">actionId</span>: [<span class="name">XrInputAction</span>.<span class="name">ThumbstickX</span>]
 }
 <span class="type"><a href="qml-qtquick3d-xr-xrinputaction.html" translate="no">XrInputAction</a></span> {
     <span class="name">id</span>: <span class="name">rightThumbstickY</span>
     <span class="name">hand</span>: <span class="name">XrInputAction</span>.<span class="name">RightHand</span>
     <span class="name">actionId</span>: [<span class="name">XrInputAction</span>.<span class="name">ThumbstickY</span>]
 }

 <span class="type"><a href="qml-qtquick3d-xr-xrvirtualmouse.html" translate="no">XrVirtualMouse</a></span> {
     <span class="name">view</span>: <span class="name">xrView</span>
     <span class="name">source</span>: <span class="name">rightController</span>
     <span class="name">leftMouseButton</span>: <span class="name">rightTrigger</span>.<span class="name">pressed</span>
     <span class="name">scrollWheelX</span>: <span class="name">rightThumbstickX</span>.<span class="name">value</span>
     <span class="name">scrollWheelY</span>: <span class="name">rightThumbstickY</span>.<span class="name">value</span>
 }
</pre>
<p>First we add two more actions to detect horizontal and vertical thumbstick position. Then we create an <a href="qml-qtquick3d-xr-xrvirtualmouse.html" translate="no">XrVirtualMouse</a>, using the <a href="qml-qtquick3d-xr-xrcontroller.html" translate="no">XrController</a> as a position source. We use the <code translate="no">rightTrigger</code> action we made earlier to generate mouse presses/releases and use the thumbstick actions to generate mouse wheel events.</p>
<p>Finally, we add some haptic feedback when the <code translate="no">pickRay</code> hits an object:</p>
<pre class="qml" translate="no">
 <span class="type"><a href="qml-qtquick3d-xr-xrhapticfeedback.html" translate="no">XrHapticFeedback</a></span> {
     <span class="name">controller</span>: <span class="name">XrHapticFeedback</span>.<span class="name">RightController</span>
     <span class="name">condition</span>: <span class="name">XrHapticFeedback</span>.<span class="name">RisingEdge</span>
     <span class="name">trigger</span>: <span class="name">pickRay</span>.<span class="name">hit</span>
     <span class="name">hapticEffect</span>: <span class="name">XrSimpleHapticEffect</span> {
         <span class="name">amplitude</span>: <span class="number">0.5</span>
         <span class="name">duration</span>: <span class="number">30</span>
         <span class="name">frequency</span>: <span class="number">3000</span>
     }
 }
</pre>
<p>The haptic effect will trigger each time the <code translate="no">pickRay.hit</code> property goes from <code translate="no">false</code> to <code translate="no">true</code>.</p>
<h4 id="xritem">XrItem</h4>
<p>The normal way to <a href="qtquick3d-2d.html">embed 2D user interfaces in 3D scenes</a> also works in XR, but since the unit size is one centimeter, those user interfaces will have to be scaled to be useful. The <a href="qml-qtquick3d-xr-xritem.html" translate="no">XrItem</a> type provides a convenient way to do the scaling automatically by setting the physical size of the 3D item and the logical size of the 2D surface.</p>
<pre class="qml" translate="no">
 <span class="type"><a href="qml-qtquick3d-xr-xritem.html" translate="no">XrItem</a></span> {
     <span class="name">width</span>: <span class="number">75</span>
     <span class="name">height</span>: <span class="number">100</span>
     <span class="name">x</span>: -<span class="number">100</span>
     <span class="name">y</span>: <span class="name">height</span> <span class="operator">+</span> <span class="name">table</span>.<span class="name">height</span> <span class="operator">+</span> <span class="number">5</span>
     <span class="name">z</span>: <span class="number">40</span>
     <span class="name">eulerRotation</span>.y: <span class="number">45</span>
     <span class="name">color</span>: <span class="string">&quot;transparent&quot;</span>
     <span class="name">contentItem</span>: <span class="name">Rectangle</span> {
         <span class="name">color</span>: <span class="name">Qt</span>.<span class="name">rgba</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0.5</span>)
         <span class="name">border</span>.width: <span class="number">5</span>
         <span class="name">border</span>.color: <span class="string">&quot;lightblue&quot;</span>
         <span class="name">height</span>: <span class="number">400</span>
         <span class="name">width</span>: <span class="number">300</span>
         <span class="name">radius</span>: <span class="number">25</span>
     ...
         }
     }
</pre>
<p>We position the <a href="qml-qtquick3d-xr-xritem.html" translate="no">XrItem</a> in three dimensions and set it to be 75 cm wide and 100 cm tall. Then add a rectangle as a content item, and set it to be 300 x 400 units. The rest of the Qt Quick UI elements are added as children of the rectangle in the normal way and are not shown here. The 2D content is automatically scaled so it fills the <a href="qml-qtquick3d-xr-xritem.html" translate="no">XrItem</a>.</p>
<p><a href="https://code.qt.io/cgit/qt/qtquick3d.git/tree/examples/quick3d/xr_input?h=6.9">Example project @ code.qt.io</a></p>
</div>
<!-- @@@xr_input -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <abbr title="Copyright">&copy;</abbr> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
