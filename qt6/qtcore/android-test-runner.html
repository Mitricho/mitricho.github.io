<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- androidtestrunner.qdoc -->
  <meta name="description" content="Overview of the androidtestrunner tool for running Qt tests on Android.">
  <title>The androidtestrunner Tool | Qt Core | Qt 6.9.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li>Qt 6.9</li>
<li><a href="qtcore-index.html">Qt Core</a></li>
<li>The androidtestrunner Tool</li>
<li id="buildversion"><a href="qtcore-index.html">Qt 6.9.0 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level1"><a href="#how-it-works">How it works</a></li>
<li class="level1"><a href="#running-tests-with-the-test-wrapper">Running tests with the test wrapper</a></li>
<li class="level1"><a href="#retrieving-results">Retrieving results</a></li>
<li class="level1"><a href="#how-to-use-it">How to use it</a></li>
<li class="level2"><a href="#mandatory-arguments">Mandatory Arguments</a></li>
<li class="level2"><a href="#optional-arguments">Optional arguments</a></li>
<li class="level2"><a href="#example-usage">Example usage</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">The androidtestrunner Tool</h1>
<!-- $$$android-test-runner.html-description -->
<div class="descr" id="details">
<h2 id="introduction">Introduction</h2>
<p>The <code translate="no">androidtestrunner</code> tool runs Qt tests on Android devices and emulators. It automates the steps required to execute tests, including managing APK installation, test execution, and retrieving results.</p>
<p>Before using the <code translate="no">androidtestrunner</code>, ensure you have configured your Qt test project with CMake or qmake.</p>
<h2 id="how-it-works">How it works</h2>
<ol class="1" type="1"><li>Firstly, it begins by executing the APK build command to generate the required APK for the test.</li>
<li>Following this, it installs the test app on the target device and starts the test app, setting the testing process in motion.</li>
<li>The test results are written to the app’s data directory on the device, ensuring that comprehensive test outputs are captured.</li>
<li>Once the tests conclude, the runner writes an exit code file beside the result files.</li>
<li>At this stage, the <code translate="no">androidtestrunner</code> retrieves these result files from the device, examining the exit code for failures.</li>
<li>If issues are detected, it immediately prints the app’s logcat logs, including any potential crash stack traces, which are beautified to reveal file names and line numbers for each frame. Additionally, it captures and reports Application Not Responding (ANR) logs if such events occur during the test execution.</li>
</ol>
<p>To enhance the integration experience, the test runner propagates QT or QTEST environment variables from the host environment of the test runner process to the app, ensuring consistency and a seamless testing workflow.</p>
<h2 id="running-tests-with-the-test-wrapper">Running tests with the test wrapper</h2>
<p>Here is an example that runs the <code translate="no">tst_android</code> test while running it on a specific emulator instance, passing an environment variable and executing only <code translate="no">testAssets</code> test case:</p>
<pre class="cpp plain" translate="no">
 ANDROID_SERIAL=emulator-5554 QT_DEBUG_PLUGINS=1 ./tst_android testAssets
</pre>
<h2 id="retrieving-results">Retrieving results</h2>
<p>By default, and if the stdout test output is not explicitly disabled, the test results are printed to the host as the test is executing. After running the tests, any explicitly requested test files are pulled into the specified output path with their respective formats.</p>
<p>For comprehensive details about Qt Test Framework, see Qt Test Overview.</p>
<h2 id="how-to-use-it">How to use it</h2>
<p>The basic syntax to run the <code translate="no">androidtestrunner</code> is as follows:</p>
<pre class="cpp plain" translate="no">
 androidtestrunner [ARGUMENTS] -- [TESTARGS]
</pre>
<p>To run the test on a specific device/emulator, use the <code translate="no">adb</code> environment varialbe <code translate="no">ANDROID_SERIAL</code> or <code translate="no">ANDROID_DEVICE_SERIAL</code>.</p>
<h3 id="mandatory-arguments">Mandatory Arguments</h3>
<p>The test runner always expects the following arguments to be passed:</p>
<ul>
<li><code translate="no">--path &lt;build-path&gt;</code>: The path where the Android Gradle package is built, commonly under <code translate="no">android-build-testname</code>.</li>
<li><code translate="no">--make &lt;build-command&gt;</code>: The command used to build the test APK, for example, <code translate="no">cmake --build &lt;build-dir&gt; --target &lt;target&gt;_make_apk</code>.<div class="admonition note">
<p><b>Note: </b>Pass this argument quoted so it's not treated as multiple arguments of the test runner but as the value of <code translate="no">--make</code> argument.</p>
</div>
</li>
<li><code translate="no">--apk &lt;apk-path&gt;</code>: The Path to the test APK that is generated by the build command and that is installed on the device.</li>
</ul>
<h3 id="optional-arguments">Optional arguments</h3>
<p>You can also pass the following optional arguments:</p>
<ul>
<li><code translate="no">--adb &lt;adb-path&gt;</code>: Specifies a custom ADB command path. Defaults to the <code translate="no">adb</code> path found in the system's <code translate="no">$PATH</code>.</li>
<li><code translate="no">--activity &lt;activity-name&gt;</code>: Specifies a custom activity to run. Defaults to the first activity defined in the <code translate="no">AndroidManifest.xml</code>.</li>
<li><code translate="no">--timeout &lt;seconds&gt;</code>: Sets the timeout for running the test. Defaults to 600 seconds (10 minutes).</li>
<li><code translate="no">--skip-install-root</code>: Avoids appending INSTALL_ROOT to the make command and is mainly useful when using <code translate="no">qmake</code>.</li>
<li><code translate="no">--show-logcat</code>: Prints the logcat output to stdout regardless of test failure. Logs are printed in case of failure and can include crash stacktraces or ANR events.</li>
<li><code translate="no">--ndk-stack &lt;command-path&gt;</code>: Specifies the path to the <a href="https://developer.android.com/ndk/guides/ndk-stack">ndk-stack</a> tool for symbolizing crash stack traces. Defaults to the tool path found under <code translate="no">$ANDROID_NDK_ROOT</code>.</li>
<li><code translate="no">--pre-test-adb-command &lt;command&gt;</code>: call the adb &lt;command&gt; after installation and before the test run.</li>
<li><code translate="no">-- &lt;arguments&gt;</code>: Passes anything after the dashes as test arguments.</li>
<li><code translate="no">--verbose</code>: Prints verbose output.</li>
<li><code translate="no">--help</code>: Displays the help information.</li>
</ul>
<h3 id="example-usage">Example usage</h3>
<p>Here is an example that runs the <code translate="no">tst_android</code> test, executing only <code translate="no">testAssets</code> test case:</p>
<pre class="cpp plain" translate="no">
 androidtestrunner \
     --path ~/tst_android/build/android-build-tst_openssl \
     --make &quot;cmake --build ~/tst_android/build --target apk&quot; \
     --apk ~/tst_android/build/android-build-tst_openssl/tst_openssl.apk \
     --skip-install-root \
     testAssets
</pre>
</div>
<!-- @@@android-test-runner.html -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <abbr title="Copyright">&copy;</abbr> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
