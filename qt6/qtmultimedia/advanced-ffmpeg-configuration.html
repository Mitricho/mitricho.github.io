<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- advanced-ffmpeg-configuration.qdoc -->
  <meta name="description" content="Lists the FFmpeg media backend's configurable features.">
  <title>Advanced FFmpeg Configuration | Qt Multimedia | Qt 6.9.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li>Qt 6.9</li>
<li><a href="qtmultimedia-index.html">Qt Multimedia</a></li>
<li>Advanced FFmpeg Configuration</li>
<li id="buildversion"><a href="qtmultimedia-index.html">Qt 6.9.0 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#enable-logging-from-ffmpeg-and-the-qt-ffmpeg-media-backend">Enable logging from FFmpeg and the Qt FFmpeg media backend</a></li>
<li class="level1"><a href="#enable-experimental-ffmpeg-codecs">Enable experimental FFmpeg codecs</a></li>
<li class="level1"><a href="#configuring-allowed-network-protocols">Configuring allowed network protocols</a></li>
<li class="level1"><a href="#configure-hardware-acceleration-in-backends">Configure hardware acceleration in backends</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Advanced FFmpeg Configuration</h1>
<!-- $$$advanced-ffmpeg-configuration.html-description -->
<div class="descr" id="details">
<p>This page lists the FFmpeg media backend's configurable features. All the features are a part of the private API and can be changed or removed in the future without confirmation. Be aware that environment variables are by default inherited by child processes and can have unintended consequences.</p>
<h2 id="enable-logging-from-ffmpeg-and-the-qt-ffmpeg-media-backend">Enable logging from FFmpeg and the Qt FFmpeg media backend</h2>
<p>You can configure advanced FFmpeg log output via environment variables.</p>
<ul>
<li><code translate="no">QT_FFMPEG_DEBUG=1</code> enables extra logging from the FFmpeg library and can help you understand issues that involve the FFmpeg library.</li>
<li><code translate="no">QT_LOGGING_RULES=&quot;*.ffmpeg.*=true&quot;</code> turns on Qt developer logs in the FFmpeg plugin. Logging categories in the FFmpeg plugin are usually called &quot;qt.multimedia.ffmpeg.XXX&quot;. To enable developer logs from all of Qt Multimedia, set <code translate="no">QT_LOGGING_RULES=&quot;*.multimedia.*=true&quot;</code></li>
<li>If you set both <code translate="no">QT_FFMPEG_DEBUG</code> and <code translate="no">QT_LOGGING_RULES</code>, all available FFmpeg codecs will be printed the first time encoding or decoding functionality is used from <a href="qmediaplayer.html" translate="no">QMediaPlayer</a>, <a href="qaudiodecoder.html" translate="no">QAudioDecoder</a>, or <a href="qmediarecorder.html" translate="no">QMediaRecorder</a>. This information can help you understand situations where Qt Multimedia doesn't find a proper FFmpeg decoder or encoder. We recommend attaching the codec dump to Qt bug reports if you encounter codec-specific issues.</li>
</ul>
<h2 id="enable-experimental-ffmpeg-codecs">Enable experimental FFmpeg codecs</h2>
<p>FFmpeg exposes a few codecs, such as Opus or Vorbis, as experimental ones. Experimental codecs don't strictly follow the standard and may be unstable. They are disabled by default. To enable them, set the environment variable <code translate="no">QT_ENABLE_EXPERIMENTAL_CODECS=1</code>.</p>
<h2 id="configuring-allowed-network-protocols">Configuring allowed network protocols</h2>
<p>For security reasons, the FFmpeg library restricts use of nested protocols, meaning protocols used by other protocols; see <a href="https://www.ffmpeg.org/ffmpeg-protocols.html">FFmpeg protocols documentation</a>. You may explicitly override the allowed protocols via the environment variable <code translate="no">QT_FFMPEG_PROTOCOL_WHITELIST</code>, for example:</p>
<pre class="cpp" translate="no">
 <span class="keyword">export</span> QT_FFMPEG_PROTOCOL_WHITELIST<span class="operator">=</span>file<span class="operator">,</span>crypto<span class="operator">,</span>rtp<span class="operator">,</span>udp
</pre>
<div class="admonition warning">
<p><b>Warning: </b>Note that nested protocols can introduce security vulnerabilities when used with untrusted data. Only allow protocols that align with your security and business requirements.</p>
</div>
<h2 id="configure-hardware-acceleration-in-backends">Configure hardware acceleration in backends</h2>
<ul>
<li>Explicit decoding and encoding hardware acceleration backends.<p>The FFmpeg plugin chooses the hardware acceleration backend for decoding and encoding based on availability, stability, efficiency, and implementation details. If the selected hardware backend doesn't work as expected, you can try setting a custom priority list or disable all the hardware backends via the environment variables <code translate="no">QT_FFMPEG_DECODING_HW_DEVICE_TYPES</code> and <code translate="no">QT_FFMPEG_ENCODING_HW_DEVICE_TYPES</code>. The available hardware backends include:</p>
<ul>
<li>cuda</li>
<li>drm</li>
<li>dxva2</li>
<li>d3d11va</li>
<li>d3d12va,</li>
<li>opencl</li>
<li>qsv</li>
<li>vaapi</li>
<li>vdpau</li>
<li>videotoolbox</li>
<li>mediacodec</li>
<li>vulkan</li>
</ul>
<p>However, the availability of hardware backends depends on the OS, installed drivers, the FFmpeg version, and configuration. It's important to keep in mind that some device types have not been tested with Qt Multimedia by the Qt maintainers, and may not operate as intended. At the time of writing, these backends include:</p>
<ul>
<li>drm</li>
<li>opencl</li>
<li>qsv</li>
<li>vdpau</li>
<li>vulkan</li>
</ul>
<p>Examples:</p>
<pre class="cpp" translate="no">
 <span class="preprocessor"># Set vdpau or cuda encoding hardware backends</span>
 <span class="keyword">export</span> QT_FFMPEG_ENCODING_HW_DEVICE_TYPES<span class="operator">=</span>vdpau<span class="operator">,</span>cuda

 <span class="preprocessor"># Set only d3d12va decoding hardware backend</span>
 <span class="keyword">export</span> QT_FFMPEG_DECODING_HW_DEVICE_TYPES<span class="operator">=</span>d3d12va

 <span class="preprocessor"># Disable decoding hw backends (set an empty list)</span>
 <span class="keyword">export</span> QT_FFMPEG_DECODING_HW_DEVICE_TYPES<span class="operator">=</span><span class="operator">,</span>
</pre>
</li>
<li>Hardware textures conversion.<p>Utilizing GPU-based conversion for decoded and rendered video frames can significantly reduce CPU usage. We aim to make use of this reature feature with as many hardware backends as possible. If you notice any rendering issues, consider testing the rendering without GPU texture conversion to identify the cause. You can disable GPU texture conversion by using the <code translate="no">QT_DISABLE_HW_TEXTURES_CONVERSION</code> environment variable: <code translate="no">QT_DISABLE_HW_TEXTURES_CONVERSION=1</code>. With the <code translate="no">VAAPI</code> hardware backend, hardware texture conversion is disabled by default. Set <code translate="no">QT_XCB_GL_INTEGRATION=xcb_egl</code> to enable it.</p>
</li>
<li>Allow codec profile mismatch.<p>If the codec profile does not match the reported capabilities of the hardware, you may ignore the mismatch and allow hardware decoding via <code translate="no">QT_FFMPEG_HW_ALLOW_PROFILE_MISMATCH=1</code>. Setting this option may be helpful, for example, when you use the hardware accelerated decoding for baseline profile H.264 with the <code translate="no">VAAPI</code> hardware backend because most of such streams satisfy the constraints of the existing H.264 hardware decoder.</p>
<div class="admonition warning">
<p><b>Warning: </b>If the stream is not supported, the enforced hardware decoding can cause entirely incorrect video output.</p>
</div>
</li>
</ul>
</div>
<!-- @@@advanced-ffmpeg-configuration.html -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <abbr title="Copyright">&copy;</abbr> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
